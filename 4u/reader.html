<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>バーコード読み取りデモ</title>
  <script src="https://unpkg.com/quagga/dist/quagga.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }
    #video-container {
      position: relative;
      width: 80%;
      max-width: 500px;
      margin: 20px auto;
      border: 2px solid #ccc;
      border-radius: 10px;
      overflow: hidden;
    }
    #interactive video {
      width: 100%;
    }
    #result {
      font-size: 1.2em;
      margin-top: 15px;
      font-weight: bold;
      color: #006400;
    }
  </style>
</head>
<body>

  <h2>バーコード読み取り（カメラ）</h2>
  <div id="video-container">
    <div id="interactive" class="viewport"></div>
  </div>
  <button id="startBtn">カメラを起動</button>
  <div id="result"></div>

  <script>
    const startBtn = document.getElementById('startBtn');
    const resultDiv = document.getElementById('result');

    startBtn.addEventListener('click', () => {
      if (navigator.mediaDevices && typeof navigator.mediaDevices.getUserMedia === 'function') {
        Quagga.init({
          inputStream: {
            name: "Live",
            type: "LiveStream",
            target: document.querySelector('#interactive'),
            constraints: {
              facingMode: "environment" // 背面カメラ優先（スマホ対応）
            }
          },
          decoder: {
            readers: ["code_128_reader", "ean_reader", "code_39_reader"]
          }
        }, (err) => {
          if (err) {
            console.error(err);
            alert("カメラの起動に失敗しました。");
            return;
          }
          Quagga.start();
        });

        Quagga.onDetected((data) => {
          const code = data.codeResult.code;
          resultDiv.textContent = "読み取り結果: " + code;
          console.log("Detected:", code);
          // 読み取ったら停止したい場合は下を有効化
          // Quagga.stop();
        });
      } else {
        alert("このブラウザはカメラに対応していません。");
      }
    });
  </script>

</body>
</html>
